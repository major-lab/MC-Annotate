#                            -*- Mode: Makefile -*-
# Makefile.in
# Copyright © 2010 Laboratoire de Biologie Informatique et Théorique.
#                  Université de Montréal
# Author           : Marc-Frédérick Blanchet
# Created On       : Wed Jun 30 11:32:00 2010
# $Revision: 1.1.1 $
# $Id: Makefile.in 1.1.1 2010-06-30 11:32:00 blanchmf $


PACKAGE = @PACKAGE@
VERSION = @VERSION@

srcdir = @srcdir@
VPATH = @srcdir@

@SET_MAKE@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
datadir = @datadir@
datarootdir = @datarootdir@
includedir = @includedir@
libdir = @libdir@

CXX = @CXX@
CXXFLAGS = @CXXFLAGS@
DEPFLAGS = @DEPFLAGS@
DEFS = @DEFS@
LD = @CXX@
LINKOPTIONS = @LINKOPTIONS@
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@

INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@
INSTALL_PROGRAM = @INSTALL_PROGRAM@

.SUFFIXES:

%.d: %.cc
	@ $(SHELL) -ec '$(CXX) $(DEPFLAGS) $(CXXFLAGS) $(DEFS) -I. -I.. -I$(srcdir) $< \
	    | sed '\''s/\($*\)\.o[ :]*/\1.o $@ : /g'\'' > $@; \
	      [ -s $@ ] || rm -f $@'

%.o: %.cc
	$(CXX) $(CXXFLAGS) $(DEFS) -I. -I.. -I$(srcdir) -c $<

PROGRAM = pdb2db
PROGRAM_CONSOLE = $(PROGRAM)
PROGRAM_CGI = $(PROGRAM).cgi
PROGRAM_CONSOLE_VERSION = $(PROGRAM_CONSOLE)-$(VERSION)
PROGRAM_CGI_VERSION = $(PROGRAM)-$(VERSION).cgi
ALL_PROGRAMS = $(PROGRAM_CONSOLE) $(PROGRAM_CGI)

SOURCES = $(PROGRAM).cc AnnotationStemsLoose.cc ModelDotBracketAnnotator.cc
SOURCES_CONSOLE = PDB2DBConsoleApp.cc
SOURCES_CGI = PDB2DBCGIApp.cc
ALL_SOURCES = $(SOURCES) $(SOURCES_CONSOLE) $(SOURCES_CGI)

HEADERS_CONSOLE = $(SOURCES:.cc=.h) $(SOURCES_CONSOLE:.cc=.h)
HEADERS_CGI = $(SOURCES:.cc=.h) $(SOURCES_CGI:.cc=.h)

OBJECTS = $(SOURCES:.cc=.o)
OBJECTS_CONSOLE = $(SOURCES_CONSOLE:.cc=.o)
OBJECTS_CGI = $(SOURCES_CGI:.cc=.o)
ALL_OBJECTS = $(ALL_SOURCES:.cc=.o)

LOCALLIBS = ../libmcannotate.a

DISTFILES = ChangeLog INSTALL Makefile.in NEWS $(SOURCES_CONSOLE) $(SOURCES_CGI) $(HEADERS_CONSOLE) $(HEADERS_CGI) \
	config.guess config.h.in config.sub configure configure.in install-sh \
	mkinstalldirs $(PROGRAM).cc

SUBDIRS =

RELEASESUBDIRS =

all: $(PROGRAM_CONSOLE) $(PROGRAM_CGI) TAGS
	@ for subdir in $(SUBDIRS); do \
	   (cd $$subdir && $(MAKE) $@) || exit 1; \
	  done

$(PROGRAM_CONSOLE): $(OBJECTS) $(OBJECTS_CONSOLE)
	$(LD) $(LINKOPTIONS) -o $@ $^ $(LDFLAGS) $(LOCALLIBS) $(LIBS)
	
$(PROGRAM_CGI): $(OBJECTS) $(OBJECTS_CGI)
	$(LD) $(LINKOPTIONS) -o $@ $^ $(LDFLAGS) $(LOCALLIBS) -lcgicc $(LIBS)

-include $(ALL_SOURCES:%.cc=%.d)
	
TAGS: $(ALL_SOURCES) $(ALL_HEADERS)
	@ etags $^

doc: html texi docbook


html: $(ALL_HEADERS)
	@ kdoc -f html -d html -p --strip-h-path -lmccore -z $^

texi: $(ALL_HEADERS)
	@ kdoc -f texinfo -d texi -p --strip-h-path -lmccore $^

docbook:$(ALL_HEADERS)
	@ kdoc -f docbook -d docbook -p --strip-h-path -lmccore $^

install: $(PROGRAM_CONSOLE) $(PROGRAM_CGI)
	@ echo Installing $(PROGRAM) in $(bindir)
	@ $(srcdir)/mkinstalldirs $(bindir)
	@ $(RM) $(bindir)/$(PROGRAM_CONSOLE)
	@ $(RM) $(bindir)/$(PROGRAM_CGI)
	@ $(INSTALL_PROGRAM) $(PROGRAM_CONSOLE) $(bindir)/$(PROGRAM_CONSOLE_VERSION)
	@ $(INSTALL_PROGRAM) $(PROGRAM_CGI) $(bindir)/$(PROGRAM_CGI_VERSION)
	@ echo Creating symbolic link $(bindir)/$(PROGRAM_CONSOLE)
	@ echo Creating symbolic link $(bindir)/$(PROGRAM_CGI)
	@ ln -f -s $(bindir)/$(PROGRAM_CONSOLE_VERSION) $(bindir)/$(PROGRAM_CONSOLE)
	@ ln -f -s $(bindir)/$(PROGRAM_CGI_VERSION) $(bindir)/$(PROGRAM_CGI)
	@ for subdir in $(SUBDIRS); do \
	   (cd $$subdir && $(MAKE) $@) || exit 1; \
	  done

uninstall:
	@ for subdir in $(SUBDIRS); do \
	   (cd $$subdir && $(MAKE) $@) || exit 1; \
	  done
	@ $(RM) $(bindir)/$(PROGRAM_CONSOLE_VERSION)
	@ $(RM) $(bindir)/$(PROGRAM_CGI_VERSION)
	@ $(RM) $(bindir)/$(PROGRAM_CONSOLE)
	@ $(RM) $(bindir)/$(PROGRAM_CGI)


mostlyclean: mostlyclean-recursive mostlyclean-local

mostlyclean-local:
	@ $(RM) *~

clean: clean-recursive clean-local

clean-local: mostlyclean-local
	@ $(RM) $(ALL_OBJECTS) $(ALL_PROGRAMS)
	@ $(RM) *.d TAGS
	@- rm -rf ii_files

distclean: distclean-recursive distclean-local

distclean-local: clean-local
	@ $(RM) Makefile config.h config.log config.status

topclean: topclean-recursive topclean-local

topclean-local: distclean-local

mostlyclean-recursive clean-recursive distclean-recursive topclean-recursive:
	@ for subdir in $(SUBDIRS); do \
	   target=`echo $@ | sed 's/-recursive//'`; \
	   echo Making $$target in $$subdir; \
	   (cd $$subdir && $(MAKE) $$target) || exit 1; \
	  done


dist:
	@ $(RM) -r $(PACKAGE)-$(VERSION)
	@ mkdir $(PACKAGE)-$(VERSION)
	@ chmod 777 $(PACKAGE)-$(VERSION)
	@ echo Copying distribution files
	@ for file in $(DISTFILES); do \
	   ln $(srcdir)/$$file $(PACKAGE)-$(VERSION) 2> /dev/null \
	     || cp -p $(srcdir)/$$file $(PACKAGE)-$(VERSION); \
	  done
	@ for subdir in $(SUBDIRS); do \
	   mkdir $(PACKAGE)-$(VERSION)/$$subdir; \
	   chmod 777 $(PACKAGE)-$(VERSION)/$$subdir; \
	   (cd $$subdir && $(MAKE) $@) || exit 1; \
	  done
	@ chmod -R a+r $(PACKAGE)-$(VERSION)
	@ tar chof $(PACKAGE)-$(VERSION).tar $(PACKAGE)-$(VERSION)
	@ gzip -9 $(PACKAGE)-$(VERSION).tar
	@ $(RM) -r $(PACKAGE)-$(VERSION)


configure: $(srcdir)/configure.in
	@ cd $(srcdir) && autoconf

config.h: $(srcdir)/config.h.in $(srcdir)/configure
	@ ./config.status $@
	@ touch config.h

Makefile: $(srcdir)/Makefile.in ./config.status
	@ ./config.status $@

config.status: $(srcdir)/configure
	@ ./config.status --recheck

# Tell versions [3.59,3.63) of GNU make not to export all variables.
# Otherwise a system limit (for SysV at least) may be exceeded.
.NOEXPORT:
